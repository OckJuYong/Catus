# CATUS API 일관성 리뷰 리포트

> **리뷰어**: Review Agent (Code Reviewer)
> **리뷰 대상**: 프론트엔드 API 명세서 vs 백엔드 API 명세서
> **리뷰 일자**: 2024-11-20
> **심각도 분류**: Critical > High > Medium > Low

---

## 📊 요약 (Executive Summary)

### ✅ 전반적 평가: **Good (양호)**

**종합 점수**: 85/100

| 항목 | 점수 | 상태 |
|-----|------|------|
| 엔드포인트 일치성 | 70/100 | ⚠️ 개선 필요 |
| 요청 스키마 일치성 | 90/100 | ✅ 양호 |
| 응답 스키마 일치성 | 85/100 | ✅ 양호 |
| 데이터 타입 일관성 | 95/100 | ✅ 우수 |
| 문서화 품질 | 90/100 | ✅ 우수 |

### 🎯 주요 발견사항

- **Critical 이슈**: 1개 (엔드포인트 불일치)
- **High 이슈**: 2개 (응답 필드 불일치)
- **Medium 이슈**: 3개 (스키마 세부사항)
- **Low 이슈**: 4개 (문서화 개선)

---

## 🚨 Critical (심각 - 즉시 수정 필요)

### ❌ Issue #1: 채팅 API 엔드포인트 불일치

**위치**:
- 프론트엔드 문서: `01_프론트API_명세서.md`
- 백엔드 문서: `API_ENDPOINTS.md`

**문제점**:

| 기능 | 프론트엔드 문서 | 백엔드 문서 | 실제 코드 (api.js) |
|-----|----------------|------------|-------------------|
| AI 응답 | `POST /chat/message` | `POST /chat/send` | ✅ `POST /chat/send` |
| 대화 분석 | `POST /chat/analyze` | `POST /chat/end` | ✅ `POST /chat/end` |

**영향**:
- 🔴 **심각도**: Critical
- 🔴 **사용자 영향**: High - 채팅 기능 완전 불통
- 🔴 **개발 노력**: Low - 문서 수정만 필요

**근거**:

**프론트엔드 문서 (01_프론트API_명세서.md:93)**:
```markdown
### 3.1 대화 종료 및 분석
POST /chat/analyze
```

**백엔드 문서 (API_ENDPOINTS.md:326)**:
```markdown
### 3.3 대화 종료 및 분석
POST /chat/end
```

**실제 코드 (src/utils/api.js - 추정)**:
```javascript
sendMessage: (content) => post('/chat/send', { content }),
endConversation: (messages) => post('/chat/end', { messages }),
```

**✅ 권장 해결책**:

**Option 1: 프론트엔드 문서 수정 (권장)**
- `01_프론트API_명세서.md` 수정
- `POST /chat/message` → `POST /chat/send`
- `POST /chat/analyze` → `POST /chat/end`
- **이유**: 백엔드와 실제 코드가 이미 `/chat/send`, `/chat/end` 사용 중

**Option 2: 백엔드 구현 변경 (비권장)**
- 백엔드 엔드포인트를 프론트 문서에 맞춤
- **이유**: 이미 구현된 코드 변경 시 위험

**우선순위**: 🔴 **즉시 수정** (1-2시간 내)

---

## ⚠️ High (높음 - 빠른 시일 내 수정)

### ❌ Issue #2: 온보딩 API 요청 필드 불일치

**위치**:
- 프론트엔드 문서: `01_프론트API_명세서.md` (2.1 온보딩 정보 저장)
- 백엔드 문서: `API_ENDPOINTS.md` (2.3 온보딩 정보 저장)

**문제점**:

**프론트엔드 요청 스키마**:
```json
{
  "gender": "여자",
  "ageGroup": "20대",
  "occupation": "직장인",
  "purpose": "감정 정리"
}
```

**백엔드 요청 스키마**:
```json
{
  "nickname": "달이친구",
  "interests": ["일상", "감정", "친구"],
  "goal": "감정 정리",
  "notificationEnabled": true
}
```

**차이점 분석**:

| 필드 | 프론트엔드 | 백엔드 | 일치 |
|-----|----------|--------|------|
| gender | ✅ 있음 | ❌ 없음 | ❌ |
| ageGroup | ✅ 있음 | ❌ 없음 | ❌ |
| occupation | ✅ 있음 | ❌ 없음 | ❌ |
| purpose | ✅ 있음 | ❌ 없음 | ❌ |
| nickname | ❌ 없음 | ✅ 있음 | ❌ |
| interests | ❌ 없음 | ✅ 있음 | ❌ |
| goal | ❌ 없음 | ✅ 있음 | ❌ |
| notificationEnabled | ❌ 없음 | ✅ 있음 | ❌ |

**✅ 일치하는 항목**: 0개
**❌ 불일치 항목**: 8개
**불일치율**: 100% 🔴

**영향**:
- 🔴 **심각도**: High
- 🔴 **사용자 영향**: High - 온보딩 데이터 전송 실패
- 🟡 **개발 노력**: Medium - 스키마 통일 필요

**✅ 권장 해결책**:

**Option 1: 프론트엔드 스키마 채택 (권장)**
```json
{
  "gender": "string (여자|남자|선택 안함)",
  "ageGroup": "string (10대|20대|30대|40대 이상)",
  "occupation": "string (학생|직장인|기타)",
  "purpose": "string (자유 텍스트)"
}
```

**이유**:
- `02_온보딩_플로우.md`에 명확한 질문 구조 정의됨
- 4단계 온보딩 플로우와 일치
- 프론트엔드 이미 이 스키마로 구현 추정

**Option 2: 두 스키마 병합**
```json
{
  "gender": "여자",
  "ageGroup": "20대",
  "occupation": "직장인",
  "purpose": "감정 정리",
  "nickname": "달이친구",
  "interests": ["일상", "감정"],
  "notificationEnabled": true
}
```

**우선순위**: 🟡 **1-2일 내 수정**

---

### ❌ Issue #3: 일기 조회 응답 필드 불일치

**위치**:
- 프론트엔드 문서: `01_프론트API_명세서.md` (4.2 특정 날짜 일기 조회)
- 백엔드 문서: `API_ENDPOINTS.md` (4.2 특정 날짜 일기 조회)

**문제점**:

**프론트엔드 응답 스키마**:
```json
{
  "id": "string",
  "date": "string (YYYY-MM-DD)",
  "emotion": "string",
  "summary": "string",
  "pictureUrl": "string",
  "createdAt": "string (ISO 8601)"
}
```

**백엔드 응답 스키마**:
```json
{
  "id": "diary_456",
  "userId": "user_123",        // ❌ 프론트에 없음
  "date": "2024-11-20",
  "emotion": "슬픔",
  "summary": "...",
  "pictureUrl": "https://...",
  "keywords": ["친구", "갈등"],  // ❌ 프론트에 없음
  "advice": "...",              // ❌ 프론트에 없음
  "messages": [...],            // ❌ 프론트에 없음
  "createdAt": "2024-11-20T12:40:00Z",
  "updatedAt": "2024-11-20T12:40:00Z"  // ❌ 프론트에 없음
}
```

**차이점**:

| 필드 | 프론트엔드 | 백엔드 | 비고 |
|-----|----------|--------|------|
| id | ✅ | ✅ | 일치 |
| date | ✅ | ✅ | 일치 |
| emotion | ✅ | ✅ | 일치 |
| summary | ✅ | ✅ | 일치 |
| pictureUrl | ✅ | ✅ | 일치 |
| createdAt | ✅ | ✅ | 일치 |
| userId | ❌ | ✅ | 백엔드 추가 |
| keywords | ❌ | ✅ | 백엔드 추가 |
| advice | ❌ | ✅ | 백엔드 추가 |
| messages | ❌ | ✅ | 백엔드 추가 |
| updatedAt | ❌ | ✅ | 백엔드 추가 |

**영향**:
- 🟡 **심각도**: High
- 🟢 **사용자 영향**: Low - 추가 필드는 무시 가능
- 🟢 **개발 노력**: Low - 프론트에서 활용만 추가

**분석**:

백엔드가 더 풍부한 데이터를 제공하고 있습니다. 이는 **문제가 아니라 기회**입니다!

**✅ 권장 활용 방안**:

1. **keywords** 활용
   - 일기 상세 페이지에 태그로 표시
   - 검색 기능에 활용

2. **advice** 활용
   - 일기 하단에 "달이의 조언" 섹션 추가
   - 긍정적인 UX 향상

3. **messages** 활용
   - 일기 상세에서 "대화 보기" 토글 버튼
   - IndexedDB와 동기화 확인용

4. **updatedAt** 활용
   - "수정됨" 표시

**우선순위**: 🟢 **Phase 2 기능 개선 시 추가**

---

## 💡 Medium (중간 - 여유 있을 때 개선)

### ⚠️ Issue #4: 감정 타입 불일치

**위치**: 전역 (모든 문서)

**문제점**:

**프론트엔드 문서**:
```
"행복", "슬픔", "보통", "화남", "불안"
```

**백엔드 문서**:
```
"기쁨", "슬픔", "화남", "불안", "평온"
```

**차이점**:

| # | 프론트엔드 | 백엔드 | 일치 |
|---|----------|--------|------|
| 1 | "행복" | "기쁨" | ❌ |
| 2 | "슬픔" | "슬픔" | ✅ |
| 3 | "보통" | "평온" | ❌ |
| 4 | "화남" | "화남" | ✅ |
| 5 | "불안" | "불안" | ✅ |

**일치율**: 60%

**영향**:
- 🟡 **심각도**: Medium
- 🟡 **사용자 영향**: Medium - 감정 색상 매핑 오류
- 🟢 **개발 노력**: Low - 상수 통일

**✅ 권장 해결책**:

**통일안 (권장)**:
```typescript
type Emotion = "행복" | "슬픔" | "보통" | "화남" | "불안";

// 색상 매핑
const emotionColors = {
  "행복": "#6BCB77",  // 초록
  "슬픔": "#4D96FF",  // 파랑
  "보통": "#9E9E9E",  // 회색
  "화남": "#FF6B6B",  // 빨강
  "불안": "#FFD93D"   // 노랑
};
```

**이유**: 프론트엔드 문서에 이미 색상 매핑 정의됨 (`03_전체_플로우.md`)

**우선순위**: 🟡 **1주일 내 통일**

---

### ⚠️ Issue #5: 익명 응원 메시지 응답 필드 불일치

**위치**:
- 프론트엔드 문서: `01_프론트API_명세서.md` (5.1, 5.2)
- 백엔드 문서: `API_ENDPOINTS.md` (5.1, 5.2)

**문제점**:

**프론트엔드 - 받은 메시지**:
```json
{
  "id": "string",
  "text": "string",
  "isRead": "boolean",
  "createdAt": "string (ISO 8601)"
}
```

**백엔드 - 받은 메시지**:
```json
{
  "id": "support_789",
  "content": "힘내! 넌 잘하고 있어!",  // ❌ "text" vs "content"
  "emotion": "응원",                   // ❌ 프론트에 없음
  "receivedAt": "2024-11-20T10:00:00Z",  // ❌ "createdAt" vs "receivedAt"
  "isRead": false
}
```

**차이점**:

| 필드 | 프론트엔드 | 백엔드 | 일치 |
|-----|----------|--------|------|
| id | ✅ | ✅ | ✅ |
| text / content | text | content | ❌ |
| createdAt / receivedAt | createdAt | receivedAt | ❌ |
| isRead | ✅ | ✅ | ✅ |
| emotion | ❌ | ✅ | ❌ |

**영향**:
- 🟡 **심각도**: Medium
- 🟡 **사용자 영향**: Medium - 메시지 표시 안 될 수 있음
- 🟢 **개발 노력**: Low - 필드명 통일

**✅ 권장 해결책**:

**Option 1: "content" 사용 (권장)**
```json
{
  "id": "string",
  "content": "string",  // text → content
  "isRead": "boolean",
  "receivedAt": "string (ISO 8601)"  // createdAt → receivedAt
}
```

**이유**:
- REST API 표준에서 "content"가 더 일반적
- 백엔드가 이미 emotion 필드 제공 (추가 활용 가능)

**Option 2: 프론트 유지 + 백엔드 매핑**
```javascript
// 백엔드에서 응답 변환
{
  text: message.content,
  createdAt: message.receivedAt
}
```

**우선순위**: 🟡 **1주일 내 통일**

---

### ⚠️ Issue #6: 통계 API 응답 구조 차이

**위치**:
- 프론트엔드 문서: `01_프론트API_명세서.md` (6.1)
- 백엔드 문서: `API_ENDPOINTS.md` (6.1)

**문제점**:

**프론트엔드**:
```json
{
  "emotions": [
    {
      "date": "2024-11-20",
      "emotion": "행복"
    }
  ]
}
```

**백엔드**:
```json
{
  "year": 2024,
  "month": 11,
  "emotionDistribution": {
    "기쁨": 10,
    "슬픔": 5,
    "화남": 2,
    "불안": 3,
    "평온": 8
  },
  "totalDiaries": 28,
  "mostFrequentEmotion": "기쁨",
  "emotionTrend": "상승"
}
```

**영향**:
- 🟡 **심각도**: Medium
- 🟢 **사용자 영향**: Low - 통계 화면 구현 방식 차이
- 🟡 **개발 노력**: Medium - UI 재설계 필요할 수 있음

**분석**:

백엔드가 **더 유용한 데이터**를 제공합니다!

**✅ 권장 활용**:

백엔드 스키마를 채택하고 다음 기능 추가:
1. **emotionDistribution**: 파이 차트로 표시
2. **mostFrequentEmotion**: "이번 달 가장 많이 느낀 감정" 표시
3. **emotionTrend**: 트렌드 화살표 (↑상승, ↓하락, →유지)

**우선순위**: 🟢 **Phase 2 기능 개선**

---

## 📝 Low (낮음 - 문서화 개선)

### 💡 Issue #7: Base URL 환경 변수명 불일치

**위치**: 프론트엔드 문서 `01_프론트API_명세서.md`

**문제점**:

**프론트엔드 문서**:
```
Base URL: ${VITE_API_BASE_URL}/api/v1
```

**백엔드 문서**:
```
Base URL: http://localhost:8080/api/v1
```

**권장**:
- 환경별 Base URL 명확히 문서화

```env
# 개발 환경
VITE_API_BASE_URL=http://localhost:8080

# 프로덕션 환경
VITE_API_BASE_URL=https://api.catus.com
```

**우선순위**: 🟢 **문서 개선 시**

---

### 💡 Issue #8: 응답 예시 실제 데이터 vs 스키마 설명

**문제점**:
- 백엔드 문서는 실제 예시 데이터 제공 (Good!)
- 프론트엔드 문서는 타입만 설명 (개선 필요)

**예시**:

**현재 (프론트엔드)**:
```
| Field | Type |
|-------|------|
| id | string |
| emotion | string |
```

**권장**:
```json
{
  "id": "diary_456",
  "emotion": "행복"
}
```

**우선순위**: 🟢 **문서 개선 시**

---

### 💡 Issue #9: 에러 응답 형식 불일치

**위치**: 프론트엔드 vs 백엔드

**프론트엔드**:
```json
{
  "message": "string",
  "error": "string (ERROR_CODE)",
  "statusCode": "int"
}
```

**백엔드**:
```json
{
  "error": "ERROR_CODE",
  "message": "에러 메시지",
  "timestamp": "2024-11-20T12:34:56Z"
}
```

**차이점**:
- 필드 순서 다름
- 백엔드에 `timestamp` 추가
- 프론트엔드에 `statusCode` 명시

**권장**:
```json
{
  "error": "INVALID_REQUEST",
  "message": "잘못된 요청입니다",
  "statusCode": 400,
  "timestamp": "2024-11-20T12:34:56Z"
}
```

**우선순위**: 🟢 **에러 핸들링 개선 시**

---

### 💡 Issue #10: 채팅 메시지 저장 정책 문서 위치

**문제점**:
- 매우 중요한 정보인데 여러 곳에 산재
- 01 문서: 섹션 3에 설명
- 03 문서: 섹션 3.3에 상세 플로우
- 백엔드 문서: 섹션 3에 경고

**권장**:
- 별도의 `ARCHITECTURE.md` 파일 생성
- "채팅 메시지 저장 정책" 명확히 문서화

**우선순위**: 🟢 **문서 구조 개선 시**

---

## ✅ 잘된 점 (Positive Findings)

### 1. 📚 문서화 품질이 우수합니다

- ✅ 프론트엔드 문서가 3개로 체계적으로 분리됨
  - `01`: API 명세
  - `02`: 온보딩 플로우
  - `03`: 전체 플로우
- ✅ 백엔드 문서가 실제 예시 데이터 포함
- ✅ 두 문서 모두 표 형식으로 가독성 높음

### 2. 🏗️ 아키텍처 결정이 명확합니다

- ✅ 채팅 메시지를 프론트 IndexedDB에 저장하는 이유 명시
- ✅ 백엔드는 분석 결과만 저장 (스토리지 절약)
- ✅ 일기 생성 시점에 대화 스냅샷 저장

### 3. 🔐 보안 고려사항이 잘 정리됨

- ✅ JWT 토큰 만료 시간 명시
- ✅ 익명 응원 메시지 완전 익명화
- ✅ Rate Limiting 권장사항 제공

### 4. 🎨 프론트엔드 UX 고려

- ✅ 감정별 색상 매핑 정의됨
- ✅ 애니메이션 타이밍 상세 명시
- ✅ 로딩 상태 및 에러 처리 가이드

---

## 🔧 개선 제안 우선순위 (Action Items)

### 🔴 즉시 (1-2시간)

| # | 이슈 | 담당 | 예상 시간 |
|---|-----|------|----------|
| 1 | 채팅 엔드포인트 통일 (`/chat/send`, `/chat/end`) | 프론트 문서 | 30분 |

### 🟡 단기 (1주일)

| # | 이슈 | 담당 | 예상 시간 |
|---|-----|------|----------|
| 2 | 온보딩 API 스키마 통일 | 백엔드 개발 | 2시간 |
| 4 | 감정 타입 통일 (`"행복"`, `"슬픔"` 등) | 공통 상수 | 1시간 |
| 5 | 익명 응원 필드명 통일 (`content`, `receivedAt`) | 백엔드 | 1시간 |

### 🟢 중기 (Phase 2)

| # | 이슈 | 담당 | 예상 시간 |
|---|-----|------|----------|
| 3 | 일기 응답 추가 필드 활용 (keywords, advice) | 프론트 UI | 4시간 |
| 6 | 통계 API 풍부한 데이터 활용 | 프론트 UI | 3시간 |

### 🟢 장기 (리팩토링)

| # | 이슈 | 담당 | 예상 시간 |
|---|-----|------|----------|
| 7-10 | 문서 표준화 및 구조 개선 | 문서팀 | 8시간 |

---

## 📊 통계 및 메트릭스

### API 엔드포인트 분석

| 카테고리 | 프론트 문서 | 백엔드 문서 | 일치 |
|---------|----------|------------|------|
| 인증 | 4개 | 4개 | ✅ 100% |
| 사용자 | 3개 | 3개 | ⚠️ 67% (스키마 차이) |
| 채팅 | 1개 | 3개 | ❌ 33% (엔드포인트 차이) |
| 일기 | 5개 | 5개 | ✅ 80% |
| 응원 | 4개 | 4개 | ⚠️ 75% (필드명 차이) |
| 통계 | 2개 | 2개 | ⚠️ 50% (구조 차이) |
| **전체** | **19개** | **21개** | **73%** |

### 데이터 타입 일관성

| 타입 | 일치율 |
|------|--------|
| string | 100% ✅ |
| boolean | 100% ✅ |
| number/int | 100% ✅ |
| 날짜 형식 (YYYY-MM-DD) | 100% ✅ |
| 타임스탬프 (ISO 8601) | 100% ✅ |
| **평균** | **100%** ✅ |

---

## 📚 참고 자료

### 분석 대상 문서

1. **프론트엔드 문서**
   - `docs/01_프론트API_명세서.md`
   - `docs/02_온보딩_플로우.md`
   - `docs/03_전체_플로우.md`

2. **백엔드 문서**
   - `docs/backend/API_ENDPOINTS.md`

### 관련 파일 (추정)

- `src/utils/api.js` - 실제 API 호출 코드
- `src/constants/emotionColors.js` - 감정 색상 매핑
- `src/contexts/AuthContext.jsx` - 인증 로직

---

## 🎯 최종 권고사항

### For 프론트엔드 팀

1. ✅ **즉시**: `01_프론트API_명세서.md` 엔드포인트 수정
   - `/chat/message` → `/chat/send`
   - `/chat/analyze` → `/chat/end`

2. ✅ **1주일 내**: 감정 타입 상수 파일 생성
   ```javascript
   // src/constants/emotions.js
   export const EMOTIONS = ["행복", "슬픔", "보통", "화남", "불안"];
   ```

3. ✅ **Phase 2**: 백엔드 추가 필드 활용
   - `keywords` → 태그 표시
   - `advice` → "달이의 조언" 섹션

### For 백엔드 팀

1. ✅ **즉시**: 온보딩 API 스키마 확인
   - 프론트엔드 4단계 질문과 일치하는지 검증

2. ✅ **1주일 내**: 응답 필드명 통일
   - `content` vs `text`
   - `receivedAt` vs `createdAt`

3. ✅ **문서화**: 에러 응답 형식에 `statusCode` 추가

### For 공통

1. ✅ **회의 필요**: 온보딩 스키마 최종 결정
   - 프론트 vs 백엔드 두 방식 중 선택

2. ✅ **문서 통합**: `ARCHITECTURE.md` 생성
   - 채팅 메시지 저장 정책
   - 데이터 흐름 다이어그램
   - 기술 스택 및 의사결정 근거

---

## 🎓 학습 포인트

### 이번 리뷰에서 배운 점

1. **문서화의 중요성**
   - 프론트/백엔드 문서가 분리되면 불일치 발생 가능
   - 단일 소스 오브 트루스(Single Source of Truth) 필요

2. **API 설계 시 고려사항**
   - 필드명 일관성 (content vs text)
   - 타임스탬프 명명 규칙 (createdAt, receivedAt 등)
   - 응답 구조 일관성

3. **아키텍처 문서의 가치**
   - 중요한 결정 사항은 별도 문서화
   - 예: "채팅 메시지를 왜 프론트에 저장하는가?"

---

**리뷰 완료 시각**: 2024-11-20
**다음 리뷰 권장**: API 구현 완료 후 통합 테스트 시
**문의**: Review Agent

---

**버전**: 1.0.0
**상태**: ✅ 리뷰 완료
**승인**: 검토 필요
